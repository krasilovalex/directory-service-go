<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Directory Admin</title>
    <style>
        :root { --primary: #2c3e50; --accent: #3498db; --success: #27ae60; --danger: #e74c3c; --warning: #f39c12; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f4f4f9; padding: 20px; color: #333; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        
        /* –ù–∞–≤–∏–≥–∞—Ü–∏—è (–¢–∞–±—ã) */
        .nav { display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 2px solid #eee; padding-bottom: 10px; }
        .nav-item { padding: 10px 20px; cursor: pointer; border-radius: 6px; font-weight: bold; color: #7f8c8d; transition: 0.3s; }
        .nav-item:hover { background-color: #ecf0f1; }
        .nav-item.active { background-color: var(--primary); color: white; }

        /* –ó–∞–≥–æ–ª–æ–≤–∫–∏ –∏ –§–æ—Ä–º–∞ */
        h1 { text-align: center; color: var(--primary); margin-bottom: 30px; }
        .control-panel { display: flex; gap: 10px; margin-bottom: 20px; background: #f8f9fa; padding: 15px; border-radius: 8px; }
        input { flex: 1; padding: 12px; border: 1px solid #ddd; border-radius: 6px; outline: none; transition: 0.2s; }
        input:focus { border-color: var(--accent); }
        
        /* –ö–Ω–æ–ø–∫–∏ */
        button { padding: 12px 24px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; transition: 0.2s; }
        .btn-add { background-color: var(--success); color: white; }
        .btn-add:hover { background-color: #219150; }
        .btn-del { background-color: var(--danger); color: white; padding: 6px 12px; font-size: 14px; }
        .btn-edit { background-color: var(--warning); color: white; padding: 6px 12px; font-size: 14px; margin-right: 5px; }

        /* –¢–∞–±–ª–∏—Ü–∞ */
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { text-align: left; padding: 15px; border-bottom: 1px solid #eee; }
        th { background-color: #f8f9fa; color: var(--primary); font-size: 14px; text-transform: uppercase; letter-spacing: 1px; }
        tr:hover { background-color: #fafafa; }
        .id-col { font-size: 10px; color: #bdc3c7; font-family: monospace; }
        .empty-state { text-align: center; padding: 20px; color: #95a5a6; font-style: italic; }
    </style>
</head>
<body>

<div class="container">
    <h1>üè¢ –ü–∞–Ω–µ–ª—å –£–ø—Ä–∞–≤–ª–µ–Ω–∏—è</h1>

    <div class="nav">
        <div class="nav-item active" onclick="switchTab('departments')">–û—Ç–¥–µ–ª—ã</div>
        <div class="nav-item" onclick="switchTab('locations')">–û—Ñ–∏—Å—ã</div>
        <div class="nav-item" onclick="switchTab('positions')">–î–æ–ª–∂–Ω–æ—Å—Ç–∏</div>
    </div>

    <div class="control-panel">
        <input type="text" id="mainInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ...">
        <button class="btn-add" onclick="createItem()">–î–æ–±–∞–≤–∏—Ç—å</button>
    </div>

    <table id="mainTable">
        <thead>
            <tr>
                <th width="50%">–ù–∞–∑–≤–∞–Ω–∏–µ / –û–ø–∏—Å–∞–Ω–∏–µ</th>
                <th width="30%">ID</th>
                <th width="20%">–î–µ–π—Å—Ç–≤–∏—è</th>
            </tr>
        </thead>
        <tbody id="tableBody">
            </tbody>
    </table>
    <div id="emptyState" class="empty-state" style="display: none;">–°–ø–∏—Å–æ–∫ –ø—É—Å—Ç</div>
</div>

<script>
    // ‚öôÔ∏è –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø: –£—á–∏–º —Ñ—Ä–æ–Ω—Ç –ø–æ–Ω–∏–º–∞—Ç—å —Ç–≤–æ–π –±—ç–∫–µ–Ω–¥
    // –ï—Å–ª–∏ —É —Ç–µ–±—è –≤ –±–∞–∑–µ –ø–æ–ª—è –Ω–∞–∑—ã–≤–∞—é—Ç—Å—è –∏–Ω–∞—á–µ, –ø–æ–ø—Ä–∞–≤—å –ø–æ–ª–µ 'field'
    const CONFIG = {
        departments: { 
            title: "–û—Ç–¥–µ–ª—ã", 
            field: "name",    // –í JSON —ç—Ç–æ –ø–æ–ª–µ "name"
            placeholder: "–ù–∞–∑–≤–∞–Ω–∏–µ –æ—Ç–¥–µ–ª–∞ (–Ω–∞–ø—Ä. IT)" 
        },
        locations: { 
            title: "–û—Ñ–∏—Å—ã", 
            field: "address", // –í JSON —ç—Ç–æ –ø–æ–ª–µ "address" (–∏–ª–∏ "city", —Å–º–æ—Ç—Ä—è —á—Ç–æ —É —Ç–µ–±—è –≥–ª–∞–≤–Ω–æ–µ)
            placeholder: "–ê–¥—Ä–µ—Å –æ—Ñ–∏—Å–∞ (–Ω–∞–ø—Ä. Moscow, Red Square)" 
        },
        positions: { 
            title: "–î–æ–ª–∂–Ω–æ—Å—Ç–∏", 
            field: "name",   // –í JSON —ç—Ç–æ –ø–æ–ª–µ "title"
            placeholder: "–ù–∞–∑–≤–∞–Ω–∏–µ –¥–æ–ª–∂–Ω–æ—Å—Ç–∏ (–Ω–∞–ø—Ä. Junior Go Developer)" 
        }
    };

    let currentEntity = 'departments'; // –¢–µ–∫—É—â–∞—è –≤–∫–ª–∞–¥–∫–∞

    // –ó–∞–ø—É—Å–∫ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
    document.addEventListener("DOMContentLoaded", () => loadData());

    // 1. –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫
    function switchTab(entity) {
        currentEntity = entity;
        
        // –í–∏–∑—É–∞–ª—å–Ω–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∫–Ω–æ–ø–æ–∫
        document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
        event.target.classList.add('active');

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        const cfg = CONFIG[entity];
        document.getElementById('mainInput').placeholder = cfg.placeholder;
        document.getElementById('mainInput').value = '';
        
        loadData(); // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–∏
    }

    // 2. –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ (GET)
    async function loadData() {
        const tbody = document.getElementById('tableBody');
        tbody.innerHTML = '<tr><td colspan="3" style="text-align:center">–ó–∞–≥—Ä—É–∑–∫–∞...</td></tr>';
        
        try {
            const response = await fetch(`/${currentEntity}`);
            const data = await response.json();
            
            renderTable(data);
        } catch (error) {
            console.error(error);
            tbody.innerHTML = '<tr><td colspan="3" style="color:red; text-align:center">–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞</td></tr>';
        }
    }

    // 3. –†–∏—Å—É–µ–º —Ç–∞–±–ª–∏—Ü—É
    function renderTable(data) {
        const tbody = document.getElementById('tableBody');
        const emptyState = document.getElementById('emptyState');
        tbody.innerHTML = "";

        if (!data || data.length === 0) {
            emptyState.style.display = 'block';
            return;
        }
        emptyState.style.display = 'none';

        const fieldName = CONFIG[currentEntity].field;

        data.forEach(item => {
            // –ï—Å–ª–∏ –≤–¥—Ä—É–≥ –ø–æ–ª–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —É –ª–æ–∫–∞—Ü–∏–∏ –Ω–µ—Ç address, –∞ –µ—Å—Ç—å city), —Å—Ç—Ä–∞—Ö—É–µ–º—Å—è
            const displayText = item[fieldName] || item.name || item.city || "---"; 

            const row = `
                <tr>
                    <td><b>${displayText}</b></td>
                    <td class="id-col">${item.id}</td>
                    <td>
                        <button class="btn-edit" onclick="editItem('${item.id}', '${displayText}')">‚úé</button>
                        <button class="btn-del" onclick="deleteItem('${item.id}')">‚úï</button>
                    </td>
                </tr>
            `;
            tbody.innerHTML += row;
        });
    }

    // 4. –°–æ–∑–¥–∞–Ω–∏–µ (POST)
    async function createItem() {
        const input = document.getElementById('mainInput');
        const value = input.value.trim();
        if (!value) return alert("–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç!");

        const fieldName = CONFIG[currentEntity].field;
        const payload = {};
        payload[fieldName] = value; // –°–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏: { name: "..." } –∏–ª–∏ { address: "..." }

        try {
            const res = await fetch(`/${currentEntity}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            if (res.ok) {
                input.value = "";
                loadData();
            } else {
                alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏");
            }
        } catch (e) { alert("–û—à–∏–±–∫–∞ —Å–µ—Ç–∏"); }
    }

    // 5. –£–¥–∞–ª–µ–Ω–∏–µ (DELETE)
    async function deleteItem(id) {
        if (!confirm("–£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å –Ω–∞–≤—Å–µ–≥–¥–∞?")) return;
        
        try {
            const res = await fetch(`/${currentEntity}/${id}`, { method: 'DELETE' });
            if (res.ok) loadData();
            else alert("–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å");
        } catch (e) { alert("–û—à–∏–±–∫–∞ —Å–µ—Ç–∏"); }
    }

    // 6. –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (PUT)
    async function editItem(id, currentValue) {
        // –ü—Ä–æ—Å—Ç–æ–π prompt –¥–ª—è —Å–∫–æ—Ä–æ—Å—Ç–∏ (–≤–∞–π–±-–∫–æ–¥ —Å—Ç–∏–ª—å)
        const newValue = prompt("–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ:", currentValue);
        if (!newValue || newValue === currentValue) return;

        const fieldName = CONFIG[currentEntity].field;
        const payload = {};
        payload[fieldName] = newValue;
        // –í–∞–∂–Ω–æ: PUT –æ–±—ã—á–Ω–æ –∑–∞—Ç–∏—Ä–∞–µ—Ç –æ–±—ä–µ–∫—Ç —Ü–µ–ª–∏–∫–æ–º. 
        // –ï—Å–ª–∏ —É —Ç–µ–±—è –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –µ—Å—Ç—å –µ—â–µ –ø–æ–ª—è (–Ω–∞–ø—Ä–∏–º–µ—Ä is_active), –æ–Ω–∏ –º–æ–≥—É—Ç —Å–±—Ä–æ—Å–∏—Ç—å—Å—è.
        // –ù–æ –¥–ª—è MVP –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–º–µ–Ω–∏ —ç—Ç–æ –æ–∫.

        try {
            const res = await fetch(`/${currentEntity}/${id}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            if (res.ok) loadData();
            else alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏. –í–æ–∑–º–æ–∂–Ω–æ, —Å–µ—Ä–≤–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç PUT –¥–ª—è —ç—Ç–æ–π —Å—É—â–Ω–æ—Å—Ç–∏.");
        } catch (e) { alert("–û—à–∏–±–∫–∞ —Å–µ—Ç–∏"); }
    }
</script>

</body>
</html>